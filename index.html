<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kasir Obat - Kedai Anteiku</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <style>
    .select2-container--bootstrap5 .select2-selection {
      height: calc(2.5rem + 2px);
      padding: 0.375rem 0.75rem;
      font-size: 1rem;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4">
    <div class="card p-4" id="kasirContainer">
      <h3 class="text-center mb-3">Kasir Obat - Kedai Anteiku</h3>
      <p id="tanggalTransaksi" class="text-muted text-center mb-4"></p>

      <div class="mb-3">
        <label for="obatSelect" class="form-label">Pilih Obat</label>
        <select class="form-select" id="obatSelect">
          <option value="">-- Pilih Obat --</option>
        </select>
      </div>

      <table class="table table-bordered" id="keranjang">
        <thead class="table-secondary">
          <tr>
            <th>Obat</th>
            <th>Harga</th>
            <th>Jumlah</th>
            <th>Subtotal</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <td colspan="3" class="text-end"><strong>Total</strong></td>
            <td colspan="2" id="totalHarga">Rp 0</td>
          </tr>
        </tfoot>
      </table>

      <div class="text-center">
        <button class="btn btn-success mt-3" onclick="saveToPDF()">Save to PDF</button>
        <button class="btn btn-info mt-3" onclick="saveAsImage()">Save as Image (PNG)</button>
      </div>
    </div>
  </div>

  <!-- Library -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/i18n/id.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    const dataObat = `ACYCLOVIR 400	56500
ACYCLOVIR CR	4000
ALLOPURINOL 	20500
AMLODIPIN 10MG HJ	49000
AMLODIPIN 5MG HJ	26500
ANDALAN PIL	15500
ANTASIDA POT	9000
AXAPROFEN 	44000
BINTAMOX SYR	9000
BIOPLACENTON	29000
CALCIFAR	21000
CALCIFAR PLUS	23000
CAVIPLEX SYR	12000
CEFIXIM SYR	11000
CETERIZIN 	24500
CETERIZIN SYR	5500
COMBANTRIN CAIR	27500
CTM 	10000
CTM POT	4000
DEXAMETHASON 0,5	9000
DEXTAF	20500
DEXTEEM PLUS	31500
DICLOFENAC SODIUM	21000
EMTURNAS TAB	23500
ERLA SM	12000
ERLA TM	12000
ERPHAFLAM	23000
ETABION	29000
ETAMOX	60500
ETAMOX FORTE SYR	10500
ETAMOX SYR	7500
FASIDOL FORTE SYR 	8000
FLACOID 0,5 POT	5500
FLUCADEX SYR	10500
GASTRUCID SYR	8500
GIOVAN BIRU	10500
GIOVAN PINK	11000
HIDROCORTISON	5500
HUFAXOL SYR	6500
ITRABAT	12500
KAOTIN SYR	9500
KASSA KOTAK	9000
KERTAS PUYER	9500
KETOKONAZOLE CR	4000
KETOKONAZOLE TAB	25500
KLIP BESAR	22000
KLIP SEDANG	7500
LANSOPRAZOLE	14000
METAMIZOLE	35500
METRONIDAZOLE TAB	25500
METYLPREDNISOLON 4	25500
MIRATRIM SYR	8000
MOLACORT 0,75	33000
MYCROGYNON	23500
NISAGON 	7500
OBH ITRASAL	8000
OMEDOM	25000
OMEDOM SYR	6000
ONDANSETRON 4	50000
ONDANSETRON 8	75000
ONDANSETRON INJ	4000
ORALIT	34000
PACETIK	23000
PACETIK SYR	5500
PIROXICAM 20	14000
PREDINSON POT	11500
PREDNISON	15000
PYREXIN 80 SUPP	7500
QUANTIDEX SYR	9000
RANITIDIN	23000
RANITIDIN INJ	6500
ROVERTON SYR	6000
SALBRON 2MG	25500
SALBRON 4MG	27500
SAMCONAL	18500
SELTIFORT SYR	7500
SPASMINAL	78000
SUCRALFATE SYR	13000
TERNIK PLUS SYR	7500
TERNIK SYR	7000
TRIANTA	26500
TRIANTA SYR	8000
VESPERUM DROP	13000
VESPERUM SYR	8000
ZENSODERM	7500
ZULTROP	32500
TRISELA SYR	7500
MIRASIC TAB	32000
ASMEF HJ	25000
VITAMIN C POT	28000`;

    const daftarObat = dataObat.trim().split("\n").map(baris => {
      const [nama, harga] = baris.split("\t");
      return { nama: nama.trim(), harga: parseInt(harga.trim()) };
    });

    $(document).ready(function () {
      const $select = $('#obatSelect');
      daftarObat.forEach((obat, index) => {
        $select.append(`<option value="${index}">${obat.nama} - Rp ${obat.harga.toLocaleString()}</option>`);
      });

      $select.select2({ theme: 'bootstrap5', placeholder: "Pilih obat..." });
      $('#tanggalTransaksi').text("Tanggal: " + new Date().toLocaleDateString("id-ID", {
        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
      }));

      $select.on('change', function () {
        const index = $(this).val();
        if (index === "") return;

        const obat = daftarObat[index];
        const tbody = $('#keranjang tbody');

        const existingRow = tbody.find(`tr[data-nama='${obat.nama}']`);
        if (existingRow.length) {
          const qtyInput = existingRow.find(".qty");
          qtyInput.val(parseInt(qtyInput.val()) + 1);
          qtyInput.trigger("input");
        } else {
          const row = `
            <tr data-nama="${obat.nama}">
              <td>${obat.nama}</td>
              <td>Rp ${obat.harga.toLocaleString()}</td>
              <td><input type="number" class="form-control qty" value="1" min="1" style="width:80px;"></td>
              <td class="subtotal">Rp ${obat.harga.toLocaleString()}</td>
              <td><button class="btn btn-danger btn-sm btn-hapus">Hapus</button></td>
            </tr>`;
          tbody.append(row);
        }

        updateTotal();
        $(this).val('').trigger('change');
      });

      $('#keranjang tbody').on('input', '.qty', function () {
        const row = $(this).closest('tr');
        const nama = row.data('nama');
        const obat = daftarObat.find(o => o.nama === nama);
        const qty = parseInt($(this).val());
        const subtotal = obat.harga * qty;
        row.find('.subtotal').text(`Rp ${subtotal.toLocaleString()}`);
        updateTotal();
      });

      $('#keranjang tbody').on('click', '.btn-hapus', function () {
        $(this).closest('tr').remove();
        updateTotal();
      });

      function updateTotal() {
        let total = 0;
        $('#keranjang tbody tr').each(function () {
          const nama = $(this).data('nama');
          const qty = parseInt($(this).find('.qty').val());
          const obat = daftarObat.find(o => o.nama === nama);
          total += obat.harga * qty;
        });
        $('#totalHarga').text(`Rp ${total.toLocaleString()}`);
      }
    });

    function saveToPDF() {
      const element = document.getElementById("kasirContainer");
      setTimeout(() => {
        html2pdf().set({
          margin: 0.5,
          filename: `transaksi_${new Date().toLocaleDateString("id-ID")}.pdf`,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
        }).from(element).save();
      }, 500);
    }

    function saveAsImage() {
      const element = document.getElementById("kasirContainer");
      html2canvas(element).then(canvas => {
        const link = document.createElement('a');
        link.download = `transaksi_${new Date().toISOString().slice(0,10)}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    }
  </script>
</body>
</html>
