<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kasir Obat - Dengan Keranjang</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Select2 -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f9fa;
    }
    .card {
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    .select2-container .select2-selection--single {
      height: 38px;
      padding: 5px 12px;
    }
  </style>
</head>
<body>
<div class="container my-5">
  <div class="card p-4" id="kasirContainer">
    <h2 class="text-center mb-4">Kasir Obat</h2>

    <div class="row g-3 align-items-end">
      <div class="col-md-6">
        <label class="form-label">Pilih Obat</label>
        <select id="obat" class="form-select select2">
          <!-- Diisi via JavaScript -->
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Jumlah</label>
        <input type="number" id="jumlah" class="form-control" value="1" min="1" />
      </div>
      <div class="col-md-3 d-grid">
        <button class="btn btn-primary" onclick="tambahKeKeranjang()">Tambah ke Keranjang</button>
      </div>
    </div>

    <div class="table-responsive mt-4">
      <table class="table table-bordered text-center align-middle">
        <thead class="table-light">
          <tr>
            <th>Obat</th>
            <th>Jumlah</th>
            <th>Harga Satuan</th>
            <th>Total</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="keranjangBody">
          <!-- Diisi JavaScript -->
        </tbody>
        <tfoot>
          <tr class="fw-bold">
            <td colspan="3">Total Keseluruhan</td>
            <td colspan="2" id="grandTotal">Rp 0</td>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="text-center">
      <button class="btn btn-success mt-3" onclick="exportPDF()">Export ke PDF</button>
    </div>
  </div>
</div>

<!-- Script -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
  const obatList = {
    "ACYCLOVIR 400": 56500, "ALLOPURINOL": 20500, "AMLODIPIN 10MG HJ": 49000,
    "ANDALAN PIL": 15500, "ANTASIDA POT": 9000, "BIOPLACENTON": 29000,
    "CALCIFAR": 21000, "CETERIZIN": 24500, "CTM": 10000,
    "DEXAMETHASON 0,5": 9000, "DEXTAF": 20500, "ETABION": 29000,
    "FLACOID 0,5 POT": 5500, "GIOVAN PINK": 11000, "KETOKONAZOLE CR": 4000,
    "KERTAS PUYER": 9500, "LANSOPRAZOLE": 14000, "METAMIZOLE": 35500,
    "OBH ITRASAL": 8000, "PREDNISON": 15000, "TRIANTA": 26500
  };

  const keranjang = [];

  $(document).ready(function () {
    const obatSelect = $("#obat");
    for (const nama in obatList) {
      obatSelect.append(`<option value="${nama}">${nama}</option>`);
    }
    $(".select2").select2({ placeholder: "Cari obat..." });
    renderKeranjang();
  });

  function tambahKeKeranjang() {
    const nama = $("#obat").val();
    const jumlah = parseInt($("#jumlah").val()) || 1;

    if (!nama) return alert("Pilih obat terlebih dahulu!");

    const harga = obatList[nama];
    const index = keranjang.findIndex(item => item.nama === nama);

    if (index >= 0) {
      keranjang[index].jumlah += jumlah;
    } else {
      keranjang.push({ nama, jumlah, harga });
    }

    renderKeranjang();
  }

  function hapusDariKeranjang(index) {
    keranjang.splice(index, 1);
    renderKeranjang();
  }

  function renderKeranjang() {
    const tbody = document.getElementById("keranjangBody");
    tbody.innerHTML = "";

    let totalSemua = 0;

    keranjang.forEach((item, i) => {
      const total = item.harga * item.jumlah;
      totalSemua += total;

      const row = `<tr>
        <td>${item.nama}</td>
        <td>${item.jumlah}</td>
        <td>Rp ${item.harga.toLocaleString()}</td>
        <td>Rp ${total.toLocaleString()}</td>
        <td><button class="btn btn-sm btn-danger" onclick="hapusDariKeranjang(${i})">Hapus</button></td>
      </tr>`;
      tbody.innerHTML += row;
    });

    document.getElementById("grandTotal").textContent = `Rp ${totalSemua.toLocaleString()}`;
  }

  function exportPDF() {
    html2pdf().from(document.getElementById("kasirContainer")).save("kasir-obat.pdf");
  }
</script>
</body>
</html>
