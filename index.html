<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apotek Meysha</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <style>
    .select2-container--bootstrap5 .select2-selection {
      min-height: 38px;
    }

    @media print {
      body * {
        visibility: hidden;
      }
      #keranjangWrapper, #keranjangWrapper *, #tanggalTransaksi {
        visibility: visible;
      }
      #keranjangWrapper {
        position: absolute;
        left: 0;
        top: 2cm;
        width: 100%;
      }
      #tanggalTransaksi {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        text-align: center;
        font-weight: bold;
      }
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="card p-4" id="kasirContainer">
      <h2 class="text-center mb-3">Apotek Meysha</h2>
      <p id="tanggalTransaksi" class="text-muted text-center mb-3"></p>

      <div class="mb-3">
        <label for="obat" class="form-label">Pilih Obat</label>
        <select id="obat" class="form-select"></select>
      </div>

      <div class="mb-3">
        <label for="jumlah" class="form-label">Jumlah</label>
        <input type="number" id="jumlah" class="form-control" min="1" value="1">
      </div>

      <button class="btn btn-primary mb-4" onclick="tambahObat()">Tambah ke Keranjang</button>

      <h5>Keranjang</h5>
      <div id="keranjangWrapper">
        <div class="table-responsive">
          <table class="table table-bordered" id="keranjang">
            <thead>
              <tr>
                <th>Nama Obat</th>
                <th>Harga Satuan</th>
                <th>Jumlah</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr>
                <th colspan="3" class="text-end">Total Harga:</th>
                <th id="totalHarga">Rp 0</th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>

      <div class="text-center">
        <button class="btn btn-success mt-3" onclick="saveToPDF()">Save to PDF</button>
        <button class="btn btn-info mt-3" onclick="saveAsImage()">Save as Image (PNG)</button>
        <button class="btn btn-secondary mt-3" onclick="printPage()">Print</button>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    const daftarObat = {
      "ACYCLOVIR 400MG TABLET NOVELL": 56500,
      "ACYCLOVIR CREAM 5% 5G NOVELL": 4000,
      "ALLOPURINOL TABLET 100MG GENERIK": 20500,
      "AMLODIPINE 10MG TABLET HEXPHARM": 49000,
      "AMLODIPINE 5MG TABLET HEXPHARM": 26500,
      "ANDALAN PIL KB 28 TABLET": 15500,
      "ANTASIDA TABLET POLIFARMA": 9000,
      "AXAPROFEN TABLET 300MG NOVELL": 44000,
      "BINTAMOX SYRUP 60ML": 9000,
      "BIOPLACENTON SALP 15G KALBE": 29000
    };

    $(document).ready(function () {
      for (const [nama, harga] of Object.entries(daftarObat)) {
        $('#obat').append(`<option value="${nama}">${nama} - Rp ${harga.toLocaleString('id-ID')}</option>`);
      }
      $('#obat').select2({ theme: 'bootstrap5' });

      document.getElementById("tanggalTransaksi").textContent =
        "Tanggal: " + new Date().toLocaleDateString("id-ID", {
          weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });
    });

    let keranjang = [];

    function tambahObat() {
      const nama = document.getElementById("obat").value;
      const jumlah = parseInt(document.getElementById("jumlah").value);
      const harga = daftarObat[nama];
      keranjang.push({ nama, harga, jumlah });
      renderKeranjang();
    }

    function renderKeranjang() {
      const tbody = document.querySelector("#keranjang tbody");
      tbody.innerHTML = "";
      let total = 0;

      keranjang.forEach(item => {
        const row = document.createElement("tr");
        const subtotal = item.harga * item.jumlah;
        total += subtotal;

        row.innerHTML = `
          <td>${item.nama}</td>
          <td>Rp ${item.harga.toLocaleString('id-ID')}</td>
          <td>${item.jumlah}</td>
          <td>Rp ${subtotal.toLocaleString('id-ID')}</td>
        `;
        tbody.appendChild(row);
      });
      document.getElementById("totalHarga").textContent = `Rp ${total.toLocaleString('id-ID')}`;
    }

    function saveToPDF() {
      const element = document.getElementById("kasirContainer");
      html2pdf().set({
        margin: 0.5,
        filename: `transaksi_${new Date().toLocaleDateString("id-ID")}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
      }).from(element).save();
    }

    function saveAsImage() {
      const element = document.getElementById("kasirContainer");
      html2canvas(element).then(canvas => {
        const link = document.createElement('a');
        link.download = `transaksi_${new Date().toLocaleDateString("id-ID")}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    }

    function printPage() {
      window.print();
    }
  </script>
</body>
</html>
