<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tambah Obat</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="container mt-5">
  <h2 class="mb-4">Tambah Obat</h2>
  <form id="obatForm">
    <div class="mb-3">
      <label for="nama" class="form-label">Nama Obat</label>
      <input type="text" class="form-control" id="nama" required>
    </div>
    <div class="mb-3">
      <label for="qty" class="form-label">Jumlah (QTY)</label>
      <input type="number" class="form-control" id="qty" required>
    </div>
    <div class="mb-3">
      <label for="satuan" class="form-label">Satuan</label>
      <input type="text" class="form-control" id="satuan" required>
    </div>
    <div class="mb-3">
      <label for="harga" class="form-label">Harga (Rp)</label>
      <input type="number" class="form-control" id="harga" required>
    </div>
    <button type="submit" class="btn btn-primary">Simpan</button>
    <button type="button" class="btn btn-secondary ms-2" id="exportPDF">Export ke PDF</button>
  </form>

  <div id="status" class="mt-3"></div>

  <script>
    const form = document.getElementById("obatForm");
    const status = document.getElementById("status");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const data = {
        nama: document.getElementById("nama").value,
        qty: document.getElementById("qty").value,
        satuan: document.getElementById("satuan").value,
        harga: document.getElementById("harga").value
      };

      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbwfMYM7rcnvaFFoPQRo4pqh_BA-6fiVy9bpht2n38yBXZd-UoZxH2gKIihQjHYbY-wBWw/exec", { // GANTI URL di sini
          method: "POST",
          body: JSON.stringify(data),
          headers: { "Content-Type": "application/json" }
        });

        const result = await res.json();
        if (result.result === "success") {
          status.innerHTML = `<div class="alert alert-success">Data berhasil disimpan!</div>`;
          form.reset();
        } else {
          throw new Error(result.message);
        }
      } catch (err) {
        status.innerHTML = `<div class="alert alert-danger">Gagal: ${err.message}</div>`;
      }
    });

    // Export PDF
    document.getElementById("exportPDF").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const nama = document.getElementById("nama").value;
      const qty = document.getElementById("qty").value;
      const satuan = document.getElementById("satuan").value;
      const harga = document.getElementById("harga").value;

      doc.setFontSize(16);
      doc.text("Data Obat", 10, 10);
      doc.setFontSize(12);
      doc.text(`Nama: ${nama}`, 10, 20);
      doc.text(`Jumlah: ${qty}`, 10, 30);
      doc.text(`Satuan: ${satuan}`, 10, 40);
      doc.text(`Harga: Rp ${harga}`, 10, 50);

      doc.save(`data-obat-${nama}.pdf`);
    });
  </script>
</body>
</html>
