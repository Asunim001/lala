<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kasir Obat - Kedai Anteiku</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <style>
    .select2-container--bootstrap5 .select2-selection {
      min-height: 38px;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="card p-4" id="kasirContainer">
      <h2 class="text-center mb-3">Kasir Obat - Kedai Anteiku</h2>
      <p id="tanggalTransaksi" class="text-muted text-center mb-3"></p>

      <div class="mb-3">
        <label for="obat" class="form-label">Pilih Obat</label>
        <select id="obat" class="form-select"></select>
      </div>

      <div class="mb-3">
        <label for="jumlah" class="form-label">Jumlah</label>
        <input type="number" id="jumlah" class="form-control" min="1" value="1">
      </div>

      <button class="btn btn-primary mb-4" onclick="tambahObat()">Tambah ke Keranjang</button>

      <h5>Keranjang</h5>
      <table class="table table-bordered" id="keranjang">
        <thead>
          <tr>
            <th>Nama Obat</th>
            <th>Harga Satuan</th>
            <th>Jumlah</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <th colspan="3" class="text-end">Total Harga:</th>
            <th id="totalHarga">Rp 0</th>
          </tr>
        </tfoot>
      </table>

      <button class="btn btn-success mt-3" onclick="saveToPDF()">Save to PDF</button>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    const daftarObat = {
      "ACYCLOVIR 400": 56500,
      "ACYCLOVIR CR": 4000,
      "ALLOPURINOL": 20500,
      "AMLODIPIN 10MG HJ": 49000,
      "AMLODIPIN 5MG HJ": 26500,
      "ANDALAN PIL": 15500,
      "ANTASIDA POT": 9000,
      "AXAPROFEN": 44000,
      "BINTAMOX SYR": 9000,
      "BIOPLACENTON": 29000,
      // ... Tambahkan sisanya sesuai kebutuhan
    };

    $(document).ready(function () {
      for (const [nama, harga] of Object.entries(daftarObat)) {
        $('#obat').append(`<option value="${nama}">${nama} - Rp ${harga.toLocaleString('id-ID')}</option>`);
      }
      $('#obat').select2({ theme: 'bootstrap5' });

      document.getElementById("tanggalTransaksi").textContent =
        "Tanggal: " + new Date().toLocaleDateString("id-ID", {
          weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });
    });

    let keranjang = [];

    function tambahObat() {
      const nama = document.getElementById("obat").value;
      const jumlah = parseInt(document.getElementById("jumlah").value);
      const harga = daftarObat[nama];
      keranjang.push({ nama, harga, jumlah });
      renderKeranjang();
    }

    function renderKeranjang() {
      const tbody = document.querySelector("#keranjang tbody");
      tbody.innerHTML = "";
      let total = 0;

      keranjang.forEach(item => {
        const row = document.createElement("tr");
        const subtotal = item.harga * item.jumlah;
        total += subtotal;

        row.innerHTML = `
          <td>${item.nama}</td>
          <td>Rp ${item.harga.toLocaleString('id-ID')}</td>
          <td>${item.jumlah}</td>
          <td>Rp ${subtotal.toLocaleString('id-ID')}</td>
        `;
        tbody.appendChild(row);
      });
      document.getElementById("totalHarga").textContent = `Rp ${total.toLocaleString('id-ID')}`;
    }

    function saveToPDF() {
      const element = document.getElementById("kasirContainer");
      setTimeout(() => {
        html2pdf().set({
          margin: 0.5,
          filename: `transaksi_${new Date().toLocaleDateString("id-ID")}.pdf`,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
        }).from(element).save();
      }, 500);
    }
  </script>
</body>
</html>
