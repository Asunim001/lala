<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apotek Meysha</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <style>
    .select2-container--bootstrap5 .select2-selection {
      min-height: 38px;
    }

    @media print {
      body * {
        visibility: hidden;
      }
      #keranjangWrapper, #keranjangWrapper *, #tanggalTransaksi {
        visibility: visible;
      }
      #keranjangWrapper {
        position: absolute;
        left: 0;
        top: 2cm;
        width: 100%;
      }
      #tanggalTransaksi {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        text-align: center;
        font-weight: bold;
      }
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="card p-4" id="kasirContainer">
      <h2 class="text-center mb-3">Apotek Meysha</h2>
      <p id="tanggalTransaksi" class="text-muted text-center mb-3"></p>

      <div class="mb-3">
        <label for="obat" class="form-label">Pilih Obat</label>
        <select id="obat" class="form-select"></select>
      </div>

      <div class="mb-3">
        <label for="jumlah" class="form-label">Jumlah</label>
        <input type="number" id="jumlah" class="form-control" min="1" value="1">
      </div>

      <button class="btn btn-primary mb-4" onclick="tambahObat()">Tambah ke Keranjang</button>

      <h5>Keranjang</h5>
      <div id="keranjangWrapper">
        <div class="table-responsive">
          <table class="table table-bordered" id="keranjang">
            <thead>
              <tr>
                <th>Nama Obat</th>
                <th>Harga Satuan</th>
                <th>Jumlah</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr>
                <th colspan="3" class="text-end">Total Harga:</th>
                <th id="totalHarga">Rp 0</th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>

      <div class="text-center">
        <button class="btn btn-success mt-3" onclick="saveToPDF()">Save to PDF</button>
        <button class="btn btn-info mt-3" onclick="saveAsImage()">Save as Image (PNG)</button>
        <button class="btn btn-secondary mt-3" onclick="printPage()">Print</button>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    const daftarObat = {
       "ACYCLOVIR 400": 56330, "ACYCLOVIR CR": 3930, "ALLOPURINOL": 20305,
    "AMLODIPIN 10MG HJ": 48470, "AMLODIPIN 5MG HJ": 26200, "ANDALAN PIL": 15500,
    "ANTASIDA POT": 9170, "AXAPROFEN": 43885, "BINTAMOX SYR": 9170,
    "BIOPLACENTON": 28820, "CALCIFAR": 20960, "CALCIFAR PLUS": 22270,
    "CAVIPLEX SYR": 11790, "CEFIXIM SYR": 11135, "CETERIZIN": 24235,
    "CETERIZIN SYR": 5240, "COMBANTRIN CAIR": 27510, "CTM": 9825,
    "CTM POT": 3930, "DEXAMETHASON 0,5": 9170, "DEXTAF": 20305,
    "DEXTEEM PLUS": 31440, "DICLOFENAC SODIUM": 20960, "EMTURNAS TAB": 23580,
    "ERLA SM": 11790, "ERLA TM": 11790, "ERPHAFLAM": 22270,
    "ETABION": 28820, "ETAMOX": 60260, "ETAMOX FORTE SYR": 10480,
    "ETAMOX SYR": 7205, "FASIDOL FORTE SYR": 7860, "FLACOID 0,5 POT": 5240,
    "FLUCADEX SYR": 10500, "GASTRUCID SYR": 8515, "GIOVAN BIRU": 10480,
    "GIOVAN PINK": 11135, "HIDROCORTISON": 5240, "HUFAXOL SYR": 6550,
    "ITRABAT": 12445, "KAOTIN SYR": 9170, "KASSA KOTAK": 3144,
    "KERTAS PUYER": 9563, "KETOKONAZOLE CR": 3930, "KETOKONAZOLE TAB": 25545,
    "KLIP BESAR": 22000, "KLIP SEDANG": 7500, "LANSOPRAZOLE": 13755,
    "METAMIZOLE": 35370, "METRONIDAZOLE TAB": 25545, "METYLPREDNISOLON 4": 25545,
    "MIRATRIM SYR": 7860, "MOLACORT 0,75": 32750, "MYCROGYNON": 23500,
    "NISAGON": 7205, "OBH ITRASAL": 8000, "OMEDOM": 24235,
    "OMEDOM SYR": 5895, "ONDANSETRON 4": 49780, "ONDANSETRON 8": 74670,
    "ONDANSETRON INJ": 4000, "ORALIT": 34060, "PACETIK": 22925,
    "PACETIK SYR": 5240, "PIROXICAM 20": 13755, "PREDINSON POT": 11135,
    "PREDNISON": 15065, "PYREXIN 80 SUPP": 7205, "QUANTIDEX SYR": 9170,
    "RANITIDIN": 22925, "RANITIDIN INJ": 6500, "ROVERTON SYR": 5895,
    "SALBRON 2MG": 25545, "SALBRON 4MG": 27510, "SAMCONAL": 18500,
    "SELTIFORT SYR": 7205, "SPASMINAL": 78000, "SUCRALFATE SYR": 13100,
    "TERNIK PLUS SYR": 7500, "TERNIK SYR": 7000, "TRIANTA": 26200,
    "TRIANTA SYR": 8000, "VESPERUM DROP": 13100, "VESPERUM SYR": 8000,
    "ZENSODERM": 7205, "ZULTROP": 32500, "TRISELA SYR": 7205,
    "MIRASIC TAB": 32095, "ASMEF HJ": 24890, "VITAMIN C POT": 28165
  };

    $(document).ready(function () {
      for (const [nama, harga] of Object.entries(daftarObat)) {
        $('#obat').append(`<option value="${nama}">${nama} - Rp ${harga.toLocaleString('id-ID')}</option>`);
      }
      $('#obat').select2({ theme: 'bootstrap5' });

      document.getElementById("tanggalTransaksi").textContent =
        "Tanggal: " + new Date().toLocaleDateString("id-ID", {
          weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });
    });

    let keranjang = [];

    function tambahObat() {
      const nama = document.getElementById("obat").value;
      const jumlah = parseInt(document.getElementById("jumlah").value);
      const harga = daftarObat[nama];
      keranjang.push({ nama, harga, jumlah });
      renderKeranjang();
    }

    function renderKeranjang() {
      const tbody = document.querySelector("#keranjang tbody");
      tbody.innerHTML = "";
      let total = 0;

      keranjang.forEach(item => {
        const row = document.createElement("tr");
        const subtotal = item.harga * item.jumlah;
        total += subtotal;

        row.innerHTML = `
          <td>${item.nama}</td>
          <td>Rp ${item.harga.toLocaleString('id-ID')}</td>
          <td>${item.jumlah}</td>
          <td>Rp ${subtotal.toLocaleString('id-ID')}</td>
        `;
        tbody.appendChild(row);
      });
      document.getElementById("totalHarga").textContent = `Rp ${total.toLocaleString('id-ID')}`;
    }

    function saveToPDF() {
      const element = document.getElementById("kasirContainer");
      html2pdf().set({
        margin: 0.5,
        filename: `transaksi_${new Date().toLocaleDateString("id-ID")}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
      }).from(element).save();
    }

    function saveAsImage() {
      const element = document.getElementById("kasirContainer");
      html2canvas(element).then(canvas => {
        const link = document.createElement('a');
        link.download = `transaksi_${new Date().toLocaleDateString("id-ID")}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    }

    function printPage() {
      window.print();
    }
  </script>
</body>
</html>
